integration:
  exchange:
    SoapCallExchangeRule:
      endpoint: insis_pam_endpoint
      securityMode: UsernamePassword
      username: 'env:insis-username'
      password: 'env:insis-password'
      ignoreNamespaces: 'env:insis-ignoreNamespaces'
      soapAction: modifyApplication
      requestType: ModifyApplRqType
      responseType: ModifyApplRsType
      jsonSchema: InsisPAM
  transformation:
    DefaultTransformationRule:
      additional: insis
      dateFormat: YYYY-MM-DD
      dateTimeFormat: 'YYYY-MM-DDThh:mm:ss'
      extends: 910211.risks.life.insis-policy.save
      in: {}
      out:
        - mappings:
            - param: soapAction
              value: modifyApplication
            - param: requestType
              value: ModifyApplRqType
        - fromIdx:
            array: datamodel.policy.insured.person-objects
          toIdx:
            useSourceIndex: true
            append: false
          mappings:
            - value: null
              payload: Insureds.Insured[n].InsuredEntity.OAccidentInsured.AccinsType

        - fromIdx:
            array: datamodel.policy.participants.beneficiaries
          toIdx:
            array: payload.InsuranceConditions.Participants.Participant
            append: true
          if: datamodel.policy.participants.is-standard-beneficiary == false
          mappings:
            - value: 'BENEFICENT'
              payload: InsuranceConditions.Participants.Participant[n].ParticipantRole
            - value: 'ACTIVE'
              payload: InsuranceConditions.Participants.Participant[n].Status
            - value: 'ENGLISH'
              payload: InsuranceConditions.Participants.Participant[n].Language

        - fromIdx:
            array: datamodel.policy.participants.beneficiaries
            condition: is-company == false && person.pid == null
          toIdx:
            array: payload.InsuranceConditions.Participants.Participant
            useSourceIndex: true
          if: datamodel.policy.participants.is-standard-beneficiary == false
          mappings:
            - element: policy.participants.beneficiaries~person.gender
              payload: InsuranceConditions.Participants.Participant[n].Entity.PersonalData.Gender
            - element: policy.participants.beneficiaries~person.birthdate
              payload: InsuranceConditions.Participants.Participant[n].Entity.PersonalData.BirthDate
            - element: policy.participants.beneficiaries~person.last-name
              payload: InsuranceConditions.Participants.Participant[n].Entity.PersonalData.Name.Family
            - element: policy.participants.beneficiaries~person.first-name
              payload: InsuranceConditions.Participants.Participant[n].Entity.PersonalData.Name.Given
            - value: ''
              payload: InsuranceConditions.Participants.Participant[n].Entity.PersonalData.PID

        - fromIdx:
            array: datamodel.policy.participants.beneficiaries
            condition: is-company == false && person.pid != null
          toIdx:
            useSourceIndex: true
          if: datamodel.policy.participants.is-standard-beneficiary == false
          mappings:
            - element: policy.participants.beneficiaries~person.pid
              payload: InsuranceConditions.Participants.Participant[n].Entity.PersonalData.PID

        - fromIdx:
            array: datamodel.policy.participants.beneficiaries
            condition: is-company == true
          toIdx:
            array: payload.InsuranceConditions.Participants.Participant
            useSourceIndex: true
          if: datamodel.policy.participants.is-standard-beneficiary == false
          mappings:
            - element: policy.participants.beneficiaries~company.name
              payload: InsuranceConditions.Participants.Participant[n].Entity.CompanyData.Name
            - value: ''
              payload: InsuranceConditions.Participants.Participant[n].Entity.CompanyData.CustomerID
            - value: ''
              payload: InsuranceConditions.Participants.Participant[n].Entity.CompanyData.CompType

        - fromIdx:
            index: '[datamodel.policy.participants.beneficiaries.length + 1 ]'
          toIdx:
            array: payload.InsuranceConditions.Participants.Participant
            append: true
          mappings:
            - element: policy.participants.holder.person.pid
              payload: InsuranceConditions.Participants.Participant[n].Entity.PersonalData.PID
            - value: 'PHOLDER'
              payload: InsuranceConditions.Participants.Participant[n].ParticipantRole
            - value: 'ACTIVE'
              payload: InsuranceConditions.Participants.Participant[n].Status
            - value: 'ENGLISH'
              payload: InsuranceConditions.Participants.Participant[n].Language

        - fromIdx:
            array: datamodel.policy.participants.holder.person.accounts
            condition: datamodel.policy.participants.payor.iban == iban
          toIdx:
            array: payload.InsuranceConditions.Participants.Participant
            condition: ParticipantRole == 'PHOLDER'
          mappings:
            - element: policy.participants.holder.person.accounts~bank-id
              payload: InsuranceConditions.Participants.Participant[n].PolicyBankAccounts.PolicyBankAccount[0].BankAccount.BankAccID
            - element: policy.participants.holder.person.accounts~bankpid
              payload: InsuranceConditions.Participants.Participant[n].PolicyBankAccounts.PolicyBankAccount[0].BankAccount.BankPID
            - element: policy.participants.holder.person.accounts~iban
              payload: InsuranceConditions.Participants.Participant[n].PolicyBankAccounts.PolicyBankAccount[0].BankAccount.AccountNo
            - value: 'BILLING'
              payload: InsuranceConditions.Participants.Participant[n].PolicyBankAccounts.PolicyBankAccount[0].AccountPurpose
