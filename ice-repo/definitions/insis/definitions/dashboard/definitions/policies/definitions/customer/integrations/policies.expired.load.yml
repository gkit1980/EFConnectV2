integration:
  exchange:
    InsisRestPQCallExchangeRule:
      endpointBaseurl: 'insis-rest-endpoint'
      verb: post
      url: '/util/query/paginated-query'
  transformation:
    DefaultTransformationRule:
      out:
        - mappings:
            - param: queryId
              value: policies.expired.client.get-detailed
            - param: policy_no
              value: ''
            - param: policy_id
              value: ''
            - param: policy_name
              value: ''
            - param: insr_type
              value: ''
            - param: p_insr_end
              value: ''
            - param: policy_state
              value: 'Policy'
            - param: p_client
              principal: pid
            - param: page_size
              datastore: insis.dashboard.policies.customer.pagination.expired.page-size
            - param: offset
              datastore: insis.dashboard.policies.customer.pagination.expired.offset
      in:
        - fromIdx:
            array: payload.rows
          toIdx:
            array: datamodel.expired-policies
            append: true
          mappings:
            - payload: 'rows[n].policy_state'
              element: expired-policies~policy_state
            - payload: 'rows[n].policy_id'
              element: expired-policies~policy_id
            - payload: 'rows[n].policy_no'
              element: expired-policies~policy_no
            - payload: 'rows[n].policy_name'
              element: expired-policies~policy_name
            - payload: 'rows[n].insr_type'
              element: expired-policies~insr_type
            - payload: 'rows[n].product_name'
              element: expired-policies~product_name
            - payload: 'rows[n].package_code'
              element: expired-policies~package_code
            - payload: 'rows[n].is_expired'
              element: expired-policies~is_expired
            - payload: 'rows[n].policy_state_name'
              element: expired-policies~policy_state_name
            - payload: 'rows[n].client_id'
              element: expired-policies~client_id
            - payload: 'rows[n].pid'
              element: expired-policies~pid
            - payload: 'rows[n].man_id'
              element: expired-policies~man_id
            - payload: 'rows[n].client_name'
              element: expired-policies~client_name
            - payload: 'rows[n].insr_begin'
              element: expired-policies~insr_begin
            - payload: 'rows[n].insr_end'
              element: expired-policies~insr_end
            - payload: 'rows[n].premium_amnt'
              element: expired-policies~premium_amnt
            - payload: 'rows[n].active_claims'
              element: expired-policies~active_claims
            - payload: 'rows[n].engagement_id'
              element: expired-policies~engagement_id
            - payload: 'rows[n].engagement_no'
              element: expired-policies~engagement_no
            - payload: 'rows[n].engagement_name'
              element: expired-policies~engagement_name
            - payload: 'rows[n].quote_id'
              element: expired-policies~quote_id
            - payload: 'rows[n].quote_no'
              element: expired-policies~quote_no
            - payload: 'rows[n].quote_status'
              element: expired-policies~quote_status
            - payload: 'rows[n].quote_status_name'
              element: expired-policies~quote_status_name
            - payload: 'rows[n].insured_objects'
              element: expired-policies~insured_objects
            - value: policy.expired.navigate.to-details
              element: expired-policies~link
            - payload: 'rows[n].total'
              datastore: 'insis.dashboard.policies.customer.pagination.expired.results-length'
        - fromIdx:
            array: payload.rows
            condition: is_expired == 0
            fromIdx:
              array: insured_objects
          toIdx:
            useSourceIndex: true
            toIdx:
              useSourceIndex: true
          mappings:
            - payload: 'rows[n].insured_objects[n].object_name'
              element: expired-policies~insured_objects~object_name
