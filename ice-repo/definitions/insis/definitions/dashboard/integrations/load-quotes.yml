integration:
  exchange:
    InsisDBExchangeRule:
      connectString: 'env:insis-db-url'
      username: 'env:insis-db-username'
      password: 'env:insis-db-password'
      queryFileURL: data/get-client-policies-detailed.sql
      queryType: JSON
  transformation:
    DefaultTransformationRule:
      out:
        - mappings:
            - param: policy_no
              value: ''
            - param: policy_id
              value: ''
            - param: policy_name
              value: ''
            - param: insr_type
              value: ''
            - param: p_insr_end
              value: ''
            - param: policy_state
              value: ''
            - param: p_client
              principal: pid
      in:
        - fromIdx:
            array: payload.rows
            condition: policy_state_name !== 'Policy'
          toIdx:
            array: datamodel.quotes
            append: true
          mappings:
            - payload: 'rows[n].engagement_id'
              element: quotes~engagement-id
            - payload: 'rows[n].policy_state'
              element: quotes~state
            - payload: 'rows[n].policy_state_name'
              element: quotes~state-name
            - payload: 'rows[n].product_name'
              element: quotes~product.name
            - payload: 'rows[n].insr_type'
              element: quotes~product.code
            - payload: 'rows[n].insr_begin'
              element: quotes~insurance.start
            - payload: 'rows[n].insr_duration'
              element: quotes~insurance.duration
            - payload: 'rows[n].insr_duration_unit'
              element: quotes~insurance.duration-unit
            - payload: 'rows[n].policy_no'
              element: quotes~policy-number
            - payload: 'rows[n].premium_amnt'
              element: quotes~price
            - payload: 'rows[n].quote_id'
              element: quotes~id
            - payload: 'rows[n].insured_objects'
              element: quotes~insured_objects
            - value: continue-quote
              element: quotes~continue
        - fromIdx:
            array: payload.rows
            condition: policy_state_name !== 'Policy'
            fromIdx:
              array: insured_objects
          toIdx:
            useSourceIndex: true
            toIdx:
              useSourceIndex: true
          mappings:
            - payload: 'rows[n].insured_objects[n].object_name'
              element: quotes~insured_objects~object_name
