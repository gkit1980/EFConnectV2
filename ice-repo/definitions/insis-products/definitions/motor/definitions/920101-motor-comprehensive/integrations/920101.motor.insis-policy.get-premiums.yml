integration:
  exchange:
    SoapCallExchangeRule:
      endpoint: insis_pam_endpoint
      securityMode: UsernamePassword
      username: 'env:insis-username'
      password: 'env:insis-password'
      ignoreNamespaces: 'env:insis-ignoreNamespaces'
      soapAction: findPolicyByNumber
      requestType: FndPlcyByNumRqType
      responseType: FndPlcyByNumRsType
      jsonSchema: InsisPAM
  transformation:
    DefaultTransformationRule:
      additional: insis
      dateFormat: YYYY-MM-DD
      dateTimeFormat: 'YYYY-MM-DDThh:mm:ss'
      extends: motor.insis-policy.get-premiums
      out:
        - mappings:
            - param: soapAction
              value: findPolicyByNumber
            - param: requestType
              value: FndPlcyByNumRqType
      in:
        - fromIdx:
            array: payload.Policy.Insureds.Insured
          toIdx:
            array: datamodel.policy.insured.vehicle-objects
            condition: 1 == 1
          mappings:
            - element: policy.insured.vehicle-objects~entity-type
              payload: Policy.Insureds.Insured[n].InsuredEntity.ObjectType
        - fromIdx:
            array: payload.Policy.Insureds.Insured
            fromIdx:
              array: InsuredEntity.OCar.SupplementaryEquipment.OAdditionalEquipment
              condition: EquipmentType == '1001'
          toIdx:
            array: datamodel.policy.insured.vehicle-objects
            condition: 1 == 1
          mappings:
            - element: policy.insured.vehicle-objects~car.additional-equipment-car-audio-parent-id
              payload: Policy.Insureds.Insured[n].InsuredEntity.OCar.SupplementaryEquipment.OAdditionalEquipment[n].ParentObjectID
        - fromIdx:
            array: payload.Policy.Insureds.Insured
            fromIdx:
              array: InsuredEntity.OCar.SupplementaryEquipment.OAdditionalEquipment
              condition: EquipmentType == '1002'
          toIdx:
            array: datamodel.policy.insured.vehicle-objects
            condition: 1 == 1
          mappings:
            - element: policy.insured.vehicle-objects~car.additional-equipment-alloy-wheels-parent-id
              payload: Policy.Insureds.Insured[n].InsuredEntity.OCar.SupplementaryEquipment.OAdditionalEquipment[n].ParentObjectID
        - fromIdx:
            array: payload.Policy.Insureds.Insured
            fromIdx:
              array: InsuredEntity.OCar.SupplementaryEquipment.OAdditionalEquipment
              condition: EquipmentType == '1003'
          toIdx:
            array: datamodel.policy.insured.vehicle-objects
            condition: 1 == 1
          mappings:
            - element: policy.insured.vehicle-objects~car.additional-equipment-other-parent-id
              payload: Policy.Insureds.Insured[n].InsuredEntity.OCar.SupplementaryEquipment.OAdditionalEquipment[n].ParentObjectID
        - fromIdx:
            array: payload.Policy.Insureds.Insured
            fromIdx:
              array: Covers.Cover
              condition: CoverCode == 'MTPL'
          toIdx:
            array: datamodel.policy.insured.vehicle-objects
            condition: 1 == 1
          mappings:
            - element: policy.insured.vehicle-objects~cover.mtpl.grc-id
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].GrcID'
            - element: policy.insured.vehicle-objects~cover.mtpl.insured-amount
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].InsuredAmount'
            - element: policy.insured.vehicle-objects~cover.mtpl.premium
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].Premium.TotalAmount'
        - fromIdx:
            array: payload.Policy.Insureds.Insured
            fromIdx:
              array: Covers.Cover
              condition: CoverCode == 'OWNDAMAGE'
          toIdx:
            array: datamodel.policy.insured.vehicle-objects
            condition: 1 == 1
          mappings:
            - element: policy.insured.vehicle-objects~cover.owndamage.grc-id
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].GrcID'
            - element: policy.insured.vehicle-objects~cover.owndamage.insured-amount
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].InsuredAmount'
            - element: policy.insured.vehicle-objects~cover.owndamage.premium
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].Premium.TotalAmount'
        - fromIdx:
            array: payload.Policy.Insureds.Insured
            fromIdx:
              array: Covers.Cover
              condition: CoverCode == 'PA'
          toIdx:
            array: datamodel.policy.insured.vehicle-objects
            condition: 1 == 1
          mappings:
            - element: policy.insured.vehicle-objects~cover.pa.grc-id
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].GrcID'
            - element: policy.insured.vehicle-objects~cover.pa.insured-amount
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].InsuredAmount'
            - element: policy.insured.vehicle-objects~cover.pa.premium
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].Premium.TotalAmount'
        - fromIdx:
            array: payload.Policy.Insureds.Insured
            fromIdx:
              array: Covers.Cover
              condition: CoverCode == 'ROAD_ASSIS'
          toIdx:
            array: datamodel.policy.insured.vehicle-objects
            condition: 1 == 1
          mappings:
            - element: policy.insured.vehicle-objects~cover.road_assis.grc-id
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].GrcID'
            - element: policy.insured.vehicle-objects~cover.road_assis.insured-amount
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].InsuredAmount'
            - element: policy.insured.vehicle-objects~cover.road_assis.premium
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].Premium.TotalAmount'
        - fromIdx:
            array: payload.Policy.Insureds.Insured
            fromIdx:
              array: Covers.Cover
              condition: CoverCode == 'VANDALISM'
          toIdx:
            array: datamodel.policy.insured.vehicle-objects
            condition: 1 == 1
          mappings:
            - element: policy.insured.vehicle-objects~cover.vandalism.grc-id
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].GrcID'
            - element: policy.insured.vehicle-objects~cover.vandalism.insured-amount
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].InsuredAmount'
            - element: policy.insured.vehicle-objects~cover.vandalism.premium
              payload: 'Policy.Insureds.Insured[n].Covers.Cover[n].Premium.TotalAmount'
