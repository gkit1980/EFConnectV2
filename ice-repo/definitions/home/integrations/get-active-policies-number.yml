integration:
  exchange:
    SoapCallExchangeRule:
      endpoint: insis_generic_endpoint
      securityMode: UsernamePassword
      username: "env:insis-username"
      password: "env:insis-password"
      ignoreNamespaces: "env:insis-ignoreNamespaces"
      soapAction: paginatedQuery
      requestType: PaginatedQueryRqType
      jsonSchema: Insis_GenericWS
  transformation:
    InsisPaginatedQueryTransformation:
      queryId: POLICIES
      additional: insis
      out:
        - mappings:
            - param: soapAction
              value: paginatedQuery
            - param: requestType
              value: PaginatedQueryRqType
        - toIdx: 0
          mappings:
            - value: PID
              payload: "FilterCriteria.FilterCriterion[n].field"
            - value: EQ
              payload: "FilterCriteria.FilterCriterion[n].operation"
            - principal: pid
              payload: "FilterCriteria.FilterCriterion[n].value"
        - toIdx: 1
          mappings:
            - value: POLICY_STATE
              payload: "FilterCriteria.FilterCriterion[n].field"
            - value: GT
              payload: "FilterCriteria.FilterCriterion[n].operation"
            - value: "-1"
              payload: "FilterCriteria.FilterCriterion[n].value"
      in:
        - fromIdx:
            array: payload.RowSet.Row
          toIdx:
            array: datamodel.policies
            append: true
          mappings:
            - payload: "RowSet.Row[n].POLICY_ID"
              element: policies~policy-id
